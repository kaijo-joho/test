/* ============================================================================
   Floating Lesson Dock (with "透けダイヤル" variables)
   - 透け具合は :root の --ld-glass-top / --ld-glass-bottom（0〜1）と
     --ld-blur（ぼかし）を調整してください。
   ========================================================================== */

/* ---- Light: ガラス感の調整ノブ ------------------------------------------ */
:root {
  /* ガラスのベース色（RGBのみ） */
  --ld-glass-rgb: 255, 255, 255;     /* light: white */

  /* ガラスの白み（上側 / 下側） … 数字を下げるほど透ける */
  --ld-glass-top: .48;
  --ld-glass-bottom: .26;

  /* ぼかし・彩度（透けを強くしたら blur も少し上げるのがコツ） */
  --ld-blur: 14px;
  --ld-sat: 1.15;

  /* 文字色・見出し色 */
  --ld-fg: rgba(0, 0, 0, .92);
  --ld-h-title: rgba(0, 0, 0, .86);

  /* パネル内の各リンクの下地の薄さ */
  --ld-item-alpha: .06;

  /* 枠線・影 */
  --ld-border: rgba(0,0,0,.07);
  --ld-shadow: 0 18px 40px rgba(0,0,0,.18), 0 2px 6px rgba(0,0,0,.12);

  /* サイズ系 */
  --ld-btn-size: 56px;
  --ld-gap: 10px;
  --ld-panel-minw: 320px;               /* 最小 */
  --ld-safe-gap: 140px;                 /* 右端の安全余白（FABの直径+余白） */
  --ld-panel-maxw: min(780px, calc(100vw - var(--ld-safe-gap))); /* 最大 */
  --ld-panel-ideal: 42vw;               /* 理想（お好みで 36〜48vw など） */
  --ld-panel-radius: 16px;
  --ld-panel-pad: 12px 16px;
}
/* 画面が広い時の理想値を少し絞る（任意） */
@media (min-width: 1600px) {
  :root { --ld-panel-ideal: 34vw; }
}

/* スマホ寄りではほぼ全幅に（任意） */
@media (max-width: 600px) {
  :root {
    --ld-panel-minw: 260px;     /* 最小幅を少し下げる */
    --ld-panel-ideal: 86vw;     /* ほぼ全幅 */
  }
}

/* ---- Dark: ガラス感の調整ノブ（黒い磨りガラス） ------------------------ */
@media (prefers-color-scheme: dark) {
  :root {
    --ld-glass-rgb: 6, 8, 10;        /* dark: near-black */
    --ld-glass-top: .74;
    --ld-glass-bottom: .58;

    --ld-blur: 16px;
    --ld-sat: 1.20;

    --ld-fg: rgba(255,255,255,.94);
    --ld-h-title: rgba(255,255,255,.96);

    --ld-item-alpha: .10;

    --ld-border: rgba(255,255,255,.12);
    --ld-shadow: 0 20px 44px rgba(0,0,0,.55), 0 6px 14px rgba(0,0,0,.38);
  }
}

/* ---- Root --------------------------------------------------------------- */
#lesson-dock.lesson-dock {
  position: fixed;
  right: 22px;             /* 左にしたければ left:22px; right:auto; */
  bottom: 22px;
  z-index: 4000;
  pointer-events: none;    /* ルートはクリック透過（子要素で有効化） */
}
.lesson-dock__stack {
  display: flex;
  flex-direction: column;
  gap: var(--ld-gap);
}
.lesson-dock__group {
  position: relative;
  pointer-events: auto;    /* ボタン/パネルは操作可 */
}

/* ---- FAB ボタン（無彩色ガラス） --------------------------------------- */
.lesson-dock__btn {
  width: var(--ld-btn-size);
  height: var(--ld-btn-size);
  border: 1px solid var(--ld-border);
  border-radius: 50%;
  display: grid;
  place-items: center;
  cursor: pointer;

  /* 画像でも絵文字でも見える neutral glass */
  background: linear-gradient(
    135deg,
    rgba(var(--ld-glass-rgb), calc(var(--ld-glass-top) * .90)),
    rgba(var(--ld-glass-rgb), var(--ld-glass-bottom))
  );
  backdrop-filter: blur(calc(var(--ld-blur) - 2px)) saturate(1.1);
  -webkit-backdrop-filter: blur(calc(var(--ld-blur) - 2px)) saturate(1.1);

  box-shadow: var(--ld-shadow);
  color: var(--ld-fg);     /* 絵文字フォールバック色 */
  font-size: 26px;         /* 絵文字サイズ */
  line-height: 1;

  transition: transform .18s ease, box-shadow .18s ease, filter .18s ease, background .2s ease;
}
.lesson-dock__btn:hover {
  transform: translateY(-2px);
  box-shadow:
    0 22px 50px rgba(0,0,0,.22),
    0 6px 12px rgba(0,0,0,.14);
}
.lesson-dock__btn:focus-visible {
  outline: 3px solid rgba(255,255,255,.55);
  outline-offset: 2px;
}

/* ボタンに PNG/SVG を入れた場合の体裁 */
.lesson-dock__btn img,
.lesson-dock__btn svg {
  width: 28px;
  height: 28px;
  display: block;
  filter: grayscale(1) contrast(1.08);
  opacity: .92;
}

/* ---- パネル（無彩色ガラス） ------------------------------------------- */
.lesson-dock__panel {
  position: absolute;
  bottom: 6px;            /* ボタン下端に合わせる */
  right: calc(var(--ld-btn-size) + 10px); /* ボタンの左に出す */

  /* ✨横幅をビューポート連動にする */
  width: clamp(
    min(var(--ld-panel-minw), var(--ld-panel-maxw)), /* 画面が狭い時は最大値を下回らないように */
    var(--ld-panel-ideal),                            /* 理想値（vw ベース） */
    var(--ld-panel-maxw)                              /* 安全余白を考慮した上限 */
  );

  padding: var(--ld-panel-pad);
  border-radius: var(--ld-panel-radius);
  border: 1px solid var(--ld-border);

  background: linear-gradient(
    135deg,
    rgba(var(--ld-glass-rgb), var(--ld-glass-top)),
    rgba(var(--ld-glass-rgb), var(--ld-glass-bottom))
  );
  backdrop-filter: blur(var(--ld-blur)) saturate(var(--ld-sat));
  -webkit-backdrop-filter: blur(var(--ld-blur)) saturate(var(--ld-sat));

  box-shadow: var(--ld-shadow);
  color: var(--ld-fg);

  /* 閉じている状態 */
  opacity: 0;
  visibility: hidden;
  transform: translateY(6px) scale(.98);
  transition:
    opacity .22s ease,
    transform .22s ease,
    visibility 0s linear .22s; /* 先に消してから不可視 */
}

/* JS が .is-open を付けたら表示 */
.lesson-dock__panel.is-open {
  opacity: 1;
  visibility: visible;
  transform: translateY(0) scale(1);
  transition:
    opacity .26s cubic-bezier(.2,.7,.2,1),
    transform .26s cubic-bezier(.2,.7,.2,1),
    visibility 0s;
}

/* ---- セクション内の見出し・リスト ------------------------------------- */
.lesson-dock__panel .ld-sec {
  display: block;
  padding: 8px 4px 10px;
  border-top: 1px solid var(--ld-border);
}
.lesson-dock__panel .ld-sec:first-child { border-top: none; padding-top: 2px; }

.lesson-dock__panel .ld-sec__title {
  margin: 0 0 6px;
  font-weight: 700;
  font-size: .98rem;
  color: var(--ld-h-title);
}

.lesson-dock__panel .ld-sec__list {
  margin: 0;
  padding: 0;
  list-style: none;
  display: grid;
  gap: 6px;
}
.lesson-dock__panel .ld-sec__item a {
  display: block;
  padding: 6px 8px;
  border-radius: 8px;
  text-decoration: none;
  color: inherit;
  background: rgba(var(--ld-glass-rgb), var(--ld-item-alpha));
  border: 1px solid var(--ld-border);
  transition: background .18s ease, transform .12s ease, box-shadow .18s ease;
}
.lesson-dock__panel .ld-sec__item a:hover {
  background: rgba(var(--ld-glass-rgb), calc(var(--ld-item-alpha) + .18));
  box-shadow: 0 6px 16px rgba(0,0,0,.10);
  transform: translateY(-1px);
}

/* ---- “次回” セクション（見出し＋タイトル＋説明） ---------------------- */
.lesson-dock__panel .ld-next__title {
  font-weight: 800;
}

/* タイトル/詳細のリンク共通：下線なし・色は継承・クリック範囲を少し広げる */
.lesson-dock__panel .ld-next__title a,
.lesson-dock__panel .ld-next__detail a {
  color: inherit;
  text-decoration: none;
  border-radius: 8px;
  padding: 2px 6px;
  position: relative;
}

/* タイトルリンクの右端に ↗ を表示して「リンクらしさ」を明示 */
.lesson-dock__panel .ld-next__title a::after {
  content: "↗";
  display: inline-block;
  margin-left: .45em;
  transform: translateY(-1px);
  opacity: .78;
}

/* ホバー/フォーカス時はうっすらハイライト */
.lesson-dock__panel .ld-next__title a:hover,
.lesson-dock__panel .ld-next__detail a:hover,
.lesson-dock__panel .ld-next__title a:focus-visible,
.lesson-dock__panel .ld-next__detail a:focus-visible {
  background: rgba(var(--ld-glass-rgb), .20);
  outline: none;
}

.lesson-dock__panel .ld-next__detail {
  margin: .25rem 0 0;
  font-size: .92rem;
  opacity: .85;
}

/* ---- 低モーション環境 --------------------------------------------------- */
@media (prefers-reduced-motion: reduce) {
  .lesson-dock__panel,
  .lesson-dock__panel.is-open,
  .lesson-dock__btn {
    transition: none !important;
  }
}

/* === Dock 内のリンク装飾を強制リセット（全体CSSより後勝ち） ============== */
#lesson-dock.lesson-dock .lesson-dock__panel a,
#lesson-dock.lesson-dock .lesson-dock__panel a:link,
#lesson-dock.lesson-dock .lesson-dock__panel a:visited {
  /* サイト共通の装飾を確実にオフにする */
  text-decoration: none !important;
  border-bottom: 0 !important;       /* 下線を border で作っている場合 */
  box-shadow: none !important;       /* 擬似下線に box-shadow を使う場合 */
  background-image: none !important; /* グラデの下線など */
  color: inherit;                     /* 文字色はパネルに合わせる */
}

/* “次回”のリンクもカード風（他セクションと同じ見た目） */
#lesson-dock.lesson-dock .ld-next__title a,
#lesson-dock.lesson-dock a.ld-next__title,
#lesson-dock.lesson-dock .ld-next__detail a {
  display: inline-block;
  margin: 2px 0;
  padding: 6px 8px;
  border-radius: 8px;
  background: rgba(var(--ld-glass-rgb), var(--ld-item-alpha));
  border: 1px solid var(--ld-border);
  transition: background .18s ease, transform .12s ease, box-shadow .18s ease;
  /* 初期状態（浮かない） */
  transform: translateY(0);
  box-shadow: none;
}

/* ホバー/フォーカスで “ふわっ” と浮かせる */
#lesson-dock.lesson-dock .ld-next__title a:hover,
#lesson-dock.lesson-dock a.ld-next__title:hover,
#lesson-dock.lesson-dock .ld-next__detail a:hover,
#lesson-dock.lesson-dock .ld-next__title a:focus-visible,
#lesson-dock.lesson-dock a.ld-next__title:focus-visible,
#lesson-dock.lesson-dock .ld-next__detail a:focus-visible,
#lesson-dock.lesson-dock a.ld-next__card:focus-visible,
#lesson-dock.lesson-dock .ld-next__detail a:focus-visible  
{
  background: rgba(var(--ld-glass-rgb), calc(var(--ld-item-alpha) + .18));
  box-shadow: 0 6px 16px rgba(0,0,0,.10);
  transform: translateY(-1px);
  outline: none;
}

/* リンクらしさの矢印（↗）は維持 */
#lesson-dock.lesson-dock .ld-next__title a::after,
#lesson-dock.lesson-dock a.ld-next__title::after {
  content: "↗";
  display: inline-block;
  margin-left: .45em;
  transform: translateY(-1px);
  opacity: .78;
}

/* 例: ./css/lesson_dock.css に追記 */
.ld-pair { display: flex; align-items: center; gap: .5rem; justify-content: space-between; }
.ld-pair__title { flex: 1 1 auto; min-width: 0; }
.ld-pair__links { display: inline-flex; gap: .5rem; flex-shrink: 0; }
.ld-pair__link { text-decoration: underline; }
.ld-next__cards { display: grid; gap: .5rem; }
.ld-next__card { display: block; padding: .6rem .8rem; border: 1px solid var(--ld-border); border-radius: .5rem; text-decoration: none; }
.ld-next__title { font-weight: 600; }
.ld-next__detail { opacity: .8; font-size: .9em; }